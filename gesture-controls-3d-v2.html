<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... your existing styles ... -->
    <style>
        /* ... your existing styles ... */
        
        #input_video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* transform: scaleX(-1); */ /* Comment out for iOS testing - causes black screen on streams */
        }
        
        /* ... rest unchanged ... */
    </style>
    
    <!-- Updated MediaPipe CDNs (latest stable as of Dec 2025) -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.4.1695469240/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.4.1695469240/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1695469240/hands.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- ... your existing body ... -->
    
    <div id="video-container">
        <video id="input_video" playsinline muted></video> <!-- Added playsinline and muted for iOS compatibility -->
    </div>
    
    <!-- ... rest unchanged ... -->
    
    <script>
        // ... your existing Three.js setup unchanged ...
        
        // --- 3. MediaPipe Logic (updated) ---
        const videoElement = document.getElementById('input_video');
        // ... existing vars ...
        
        // ... onResults unchanged ...
        
        const hands = new Hands({locateFile: (file) => {
            return `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1695469240/${file}`;
        }});

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.5, // Lowered slightly for iOS edge cases
            minTrackingConfidence: 0.5
        });

        hands.onResults(onResults);

        const cameraUtils = new Camera(videoElement, {
            onFrame: async () => {
                await hands.send({image: videoElement});
            },
            width: 320,
            height: 240
        });
        
        // Add error handling for stream start
        cameraUtils.onError = (error) => {
            console.error('Camera error:', error);
            gestureDataText.innerText = `Camera error: ${error.message}`;
        };
        
        cameraUtils.start()
            .then(() => {
                // Explicit play() nudge for iOS stream rendering
                videoElement.play().catch(e => console.warn('iOS play warning:', e));
            })
            .catch(error => {
                console.error('Failed to start camera:', error);
                gestureDataText.innerText = `Start failed: ${error.message}`;
            });

        // ... rest of script unchanged ...
    </script>
</body>
</html>
